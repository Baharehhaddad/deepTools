<tool id="deeptools_plot_correlation" name="plotCorrelation" version="@WRAPPER_VERSION@.0">
    <description>creates a heatmap for a score associated to genomic regions</description>
    <macros>
        <token name="@BINARY@">plotCorrelation</token>
        <import>deepTools_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command>
<![CDATA[
        @BINARY@
            --corData "$corData"
            --plotFile "$outFileName"
            --corMethod "$corMethod"
            --whatToPlot "$whatToPlot"
            $skipZeros
            --plotFileFormat "$outFileFormat"
            $removeOutliers
            --outFileCorMatrix "$matrix"
            @HEATMAP_OPTIONS@

]]>
    </command>
    <inputs>
        <param name="corData" format="deeptools_coverage_matrix" type="data" label="Matrix file from the bamCorrelate tool"/>
        <expand macro="corMethod" />

        <param argument="--whatToPlot" type="select" label="Plotting type">
            <option value="heatmap" selected="True">Heatmap</option>
            <option value="scatterplot">Scatterplot</option>
        </param>

        <expand macro="skipZeros" />

        <expand macro="image_file_format" />

        <param argument="--removeOutliers" type="boolean"
            truevalue="--removeOutliers" falsevalue="" label="Remove regions with very large counts"
            help="If set, bins with very large counts are removed. Bins
                with abnormally high reads counts artificially
                increase pearson correlation; that's why, by default,
                bamCorrelate tries to remove outliers using the median
                absolute deviation (MAD) method applying a threshold
                of 200 to only consider extremely large deviations
                from the median. ENCODE blacklist page (https://sites.
                google.com/site/anshulkundaje/projects/blacklists)
                contains useful information about regions with
                unusually high counts."/>

        <param name="outFileCorMatrix" type="boolean" label="Save the matrix of values underlying the heatmap"/>
        <expand macro="heatmap_options" />

    </inputs>
    <outputs>
        <expand macro="output_image_file_format" />
        <data format="tabular" name="matrix" label="${tool.name} on ${on_string}: Correlation matrix">
            <filter>outFileCorMatrix is True</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="corData" value="bamCorrelate_result1.npz" ftype="deeptools_coverage_matrix" />
            <param name="outFileFormat" value="png" />
            <param name="outFileCorMatrix" value="True" />
            <output name="matrix" file="plotCorrelation_result1.tabular" ftype="tabular" />
            <output name="outFileName" file="plotCorrelation_result1.png" ftype="png" compare="sim_size" delta="100" />
        </test>
        <test>
            <param name="corData" value="bamCorrelate_result1.npz" ftype="deeptools_coverage_matrix" />
            <param name="outFileFormat" value="png" />
            <param name="whatToPlot" value="scatterplot" />
            <param name="removeOutliers" value="True" />
            <param name="plotTitle" value="Test Plot" />
            <output name="outFileName" file="plotCorrelation_result2.png" compare="sim_size" delta="100" />
        </test>
    </tests>
    <help>
<![CDATA[
**What it does**

Tool for visualizing a correlation using either bamCorrelate or
bigwigCorrelate. Pearson or Spearman methods are available to compute correlation
coefficients. Results can be saved into a heat map image or as multiple
scatter plots. Further output files are optional.

-----

@REFERENCES@
]]>
    </help>
    <expand macro="citations" />
</tool>
